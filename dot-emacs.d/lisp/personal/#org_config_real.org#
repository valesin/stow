(use-package org
  :ensure t
  :bind
  (("C-c l" . org-store-link)
   ("C-c a" . org-agenda)
   ("C-c c" . org-capture)
   ("C-c s" . org-anki-sync-entry))
  
  :custom
  (org-directory "~/Documents/")
  (org-todo-keywords
   '((sequence "TODO" "STARTED" "WAITING" "APPT" "|" "DONE" "CANCELLED" "DEFERRED")))
  (org-agenda-files '("/home/vjo/Documents/Personal/Planner/" 
                     "/home/vjo/Documents/Personal/Notes/"))
  (org-hide-emphasis-markers t)
  (org-indent-indentation-per-level 4)
  (org-startup-indented t)
  (org-special-ctrl-a/e t)
  (org-special-ctrl-k t)
  (org-log-done t)
  (org-M-RET-may-split-line nil)
  (org-src-fontify-natively t)
  (org-id-link-to-org-use-id t)
  
  ;; Refile settings
  (org-refile-targets '((org-agenda-files :maxlevel . 5) 
                        (nil :maxlevel . 10)))
  (org-refile-use-outline-path 'file)
  
  ;; Babel settings
  (org-confirm-babel-evaluate nil)
  
  ;; Publishing settings
  (org-publish-project-alist
   '(("Uni"
      :publishing-function org-html-publish-to-html
      :base-directory "/home/vjo/Documents/Notes/Uni/"
      :publishing-directory "/home/vjo/Public/uni_notes"
      :recursive t
      :with-creator nil
      :with-author nil
      :section-numbers nil
      :with-toc t
      :htmlized-source t
      :auto-sitemap t
      :with-latex t
      :html-validation-link nil
      :html-head-include-scripts nil
      :html-head-include-default-style nil
      :html-head "<link rel=\"stylesheet\" href=\"https://cdn.simplecss.org/simple.min.css\" onerror=\"this.onerror=null;this.href='local.css';\" />"
      :with-broken-links 'mark)))
  
  ;; MathJax settings
  (org-html-mathjax-options
   '((path "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js")
     (scale 1.0)
     (align "center")
     (font "mathjax-modern")
     (overflow "scale")
     (tags "ams")
     (indent "0em")
     (multlinewidth "85%")
     (tagindent ".8em")
     (tagside "right")))
  
  (org-html-mathjax-template
   "<script>
    window.MathJax = {
      tex: {
        ams: { multlineWidth: '%MULTLINEWIDTH' },
        {packages: {'[+]': ['mathtools']}},
        tags: '%TAGS',
        tagSide: '%TAGSIDE',
        tagIndent: '%TAGINDENT'
      },
      chtml: {
        scale: %SCALE,
        displayAlign: '%ALIGN',
        displayIndent: '%INDENT'
      },
      svg: {
        scale: %SCALE,
        displayAlign: '%ALIGN',
        displayIndent: '%INDENT'
      },
      output: {
        font: '%FONT',
        displayOverflow: '%OVERFLOW'
      },
      loader: {
        load: ['[tex]/mathtools']
      },
    };
    </script>
    <script id=\"MathJax-script\" async src=\"%PATH\"></script>")

  :config
  ;; Capture templates
  (setq org-capture-templates
        '(("t" "todo" entry
           (file "~/Documents/Personal/inbox.org")
           "* TODO %?\nFrom: %a\n")
          
          ("i" "info to process" entry
           (file "~/Documents/Personal/inbox.org")
           "* %? \n:PROPERTIES:\n:ID: %(org-id-uuid)\n:CREATED: %U\n:END:\nFrom: %a\n")
          
          ("j" "journal" entry
           (file+datetree "~/Documents/Personal/journal.org")
           "* %^{Title}\t%^g \n:PROPERTIES:\n:ID: %(org-id-uuid)\n:CREATED:%U\n:END:\n%?\n")
          
          ("r" "References")
          
          ("rw" "bookmarks" entry
           (file+headline "~/Documents/Personal/Reference/references.org" "Bookmarks")
           "\n* [[%^{Link}][%^{Title}]]      %^g\n:PROPERTIES:\n:ID: %(org-id-uuid)\n:CREATED: %U\n:END:\n%?\n")
          
          ("rb" "books" entry
           (file+headline "~/Documents/Personal/Reference/references.org" "Books")
           "\n* [[%^{Link}][%^{Title}]]      %^g\n:PROPERTIES:\n:ID: %(org-id-uuid)\n:CREATED: %U\n:END:\n%?\n")
          
          ("rf" "feed" entry
           (file+headline "~/Documents/Personal/Reference/rssfeeds.org" "Uncategorized")
           "\n* [[%^{Link}][%^{Title}]]      %^g\n:PROPERTIES:\n:CREATED: %U\n:END:\n%?\n")))
  
  ;; Refile candidates function
  (defun org-refile-candidates ()
    (directory-files-recursively "~/Documents/Notes/Uni" "^[[:alnum:]].*\\.org\\'"))
  (add-to-list 'org-refile-targets '(org-refile-candidates :maxlevel . 3))
  
  ;; Babel languages
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . nil)
     (ocaml . t)
     (go . t)
     (latex . t))))

(use-package htmlize
  :ensure t)

(use-package cdlatex
  :ensure t
  :hook (org-mode . turn-on-org-cdlatex))

(use-package ob-go
  :ensure t)

(use-package ob-ocaml
  :ensure t)

(use-package org-web-tools
  :ensure t)